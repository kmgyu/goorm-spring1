<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:fragment="layout (title, content)"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!--Dialect 방식-->
<!--<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">-->
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:replace="${title}">Goorm Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-50 text-gray-800">
<!-- HEADER -->
<!--<div layout:fragment="header"></div>-->
<div th:replace="layout/header :: header"></div>

<!--flash message-->
<div th:if="${message}">
    <div id="flash"
         role="status"
         aria-live="polite"
         class="fixed right-4 top-6 z-50 max-w-sm w-[22rem]
              translate-x-full opacity-0
              bg-white border border-green-200 shadow-lg rounded-xl
              p-4 pl-5 pr-10
              flex items-start gap-3
              transition-all duration-500 ease-out">
        <!-- 아이콘 -->
        <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-green-600" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>

        <!-- 내용 -->
        <div class="min-w-0">
            <p class="text-sm text-gray-900 font-medium" th:text="#{${message}}">메시지</p>
        </div>

        <!-- 닫기 버튼 -->
        <button type="button" id="flashClose"
                class="absolute top-2.5 right-2.5 inline-flex items-center justify-center
                   w-6 h-6 rounded-md hover:bg-gray-100 focus:outline-none"
                aria-label="알림 닫기">
            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 6l12 12M18 6l-12 12"/>
            </svg>
        </button>

        <!-- 진행 바 -->
        <div class="absolute left-0 right-0 bottom-0 h-1 bg-green-100 rounded-b-xl overflow-hidden">
            <div id="flashProgress" class="h-full bg-green-500"></div>
        </div>
    </div>
</div>


<!-- PAGE CONTENT -->
<main class="flex-1">
    <th:block th:replace="${content}">내용</th:block>
</main>

<!-- FOOTER -->
<!--Dialect 방식-->
<!--<div layout:fragment="footer"></div>-->
<div th:replace="layout/footer :: footer"></div>
</body>
<style>
    /* 진행 바 애니메이션 (너비 100% → 0%) */
    @keyframes shrink {
        from { width: 100%; }
        to   { width: 0%; }
    }
    /* 숨김 시 트랜지션이 끝나면 display:none 처리하고 싶다면 JS에서 제거합니다. */
</style>

<script th:inline="javascript">
    (function () {
        const flash = document.getElementById('flash');
        if (!flash) return;

        const progress = document.getElementById('flashProgress');
        const closeBtn = document.getElementById('flashClose');

        // 총 표시 시간(ms)
        const DURATION = 3000;

        // 초기 상태: 오른쪽 밖(translate-x-full) → 나타나기
        requestAnimationFrame(() => {
            flash.classList.remove('translate-x-full', 'opacity-0');
            flash.classList.add('translate-x-0', 'opacity-100');
        });

        // 진행 바 애니메이션 시작
        progress.style.animation = `shrink ${DURATION}ms linear forwards`;

        let start = performance.now();
        let remaining = DURATION;
        let hideTimer = setTimeout(exit, remaining);
        let paused = false;

        // 마우스 오버 시 일시정지
        flash.addEventListener('mouseenter', () => {
            if (paused) return;
            paused = true;
            clearTimeout(hideTimer);
            const elapsed = performance.now() - start;
            remaining = Math.max(0, remaining - elapsed);
            progress.style.animationPlayState = 'paused';
        });

        // 마우스 아웃 시 재개
        flash.addEventListener('mouseleave', () => {
            if (!paused) return;
            paused = false;
            start = performance.now();
            progress.style.animationPlayState = 'running';
            hideTimer = setTimeout(exit, remaining);
        });

        // 수동 닫기
        closeBtn.addEventListener('click', exit);

        function exit() {
            // 중복 호출 방지
            if (!flash) return;
            flash.classList.add('opacity-0', 'translate-x-full');
            flash.classList.remove('translate-x-0', 'opacity-100');
            // 트랜지션 종료 후 제거
            setTimeout(() => {
                if (flash && flash.parentNode) {
                    flash.parentNode.removeChild(flash);
                }
            }, 500); // transition duration과 동일
        }
    })();
</script>

</html>